{"is_source_file": true, "format": "Python", "description": "This file defines a StorageService class for managing file storage within a project. It handles saving new file versions and retrieving absolute paths for stored files, using user and document identifiers to organize the directory structure.", "external_files": ["os", "shutil", "datetime", "typing.Tuple", "flask.current_app", "../utils"], "external_methods": ["ensure_dir", "compute_checksum"], "published": ["StorageService"], "classes": [{"name": "StorageService", "description": "A class responsible for managing file storage, including saving new versions of documents and retrieving file paths based on user and document identifiers."}], "methods": [{"name": "__init__(self)", "description": "Initializes the StorageService, setting the root storage directory from the application's configuration and ensuring the directory exists.", "scope": "StorageService", "scopeKind": "class"}, {"name": "str _doc_dir(self, user_id: int, document_id: int)", "description": "Constructs the directory path for a specific user's document and ensures it exists.", "scope": "StorageService", "scopeKind": "class"}, {"name": "Tuple[str,int,str] save_new_version(self, user_id: int, document_id: int, filename: str, file_stream)", "description": "Saves a new version of a file for a user and document, generating a timestamped filename, saving the file stream, calculating its size and checksum, and returning its relative path along with metadata.", "scope": "StorageService", "scopeKind": "class"}, {"name": "str get_absolute_path(self, relative_path: str)", "description": "Returns the absolute filesystem path for a given relative file path.", "scope": "StorageService", "scopeKind": "class"}], "calls": ["ensure_dir(self.root)", "ensure_dir(path)", "shutil.copyfileobj(file_stream, out)", "os.path.getsize(abs_path)", "compute_checksum(abs_path)", "os.path.relpath(abs_path, self.root)", "os.path.join(self.root, relative_path)"], "search-terms": ["StorageService", "save_new_version", "get_absolute_path", "STORAGE_ROOT", "file storage", "versioned file storage"], "state": 2, "file_id": 10, "knowledge_revision": 65, "git_revision": "82b473343a59e362c8f258687bc9b10c13518634", "revision_history": [{"22": ""}, {"65": "82b473343a59e362c8f258687bc9b10c13518634"}], "ctags": [{"_type": "tag", "name": "StorageService", "path": "/home/kavia/workspace/code-generation/document-processing-platform-18817-18826/intelligent_receipt_processing_backend/app/services/storage_service.py", "pattern": "/^class StorageService:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "__init__", "path": "/home/kavia/workspace/code-generation/document-processing-platform-18817-18826/intelligent_receipt_processing_backend/app/services/storage_service.py", "pattern": "/^    def __init__(self):$/", "language": "Python", "kind": "member", "signature": "(self)", "scope": "StorageService", "scopeKind": "class"}, {"_type": "tag", "name": "_doc_dir", "path": "/home/kavia/workspace/code-generation/document-processing-platform-18817-18826/intelligent_receipt_processing_backend/app/services/storage_service.py", "pattern": "/^    def _doc_dir(self, user_id: int, document_id: int) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(self, user_id: int, document_id: int)", "scope": "StorageService", "scopeKind": "class"}, {"_type": "tag", "name": "get_absolute_path", "path": "/home/kavia/workspace/code-generation/document-processing-platform-18817-18826/intelligent_receipt_processing_backend/app/services/storage_service.py", "pattern": "/^    def get_absolute_path(self, relative_path: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(self, relative_path: str)", "scope": "StorageService", "scopeKind": "class"}, {"_type": "tag", "name": "save_new_version", "path": "/home/kavia/workspace/code-generation/document-processing-platform-18817-18826/intelligent_receipt_processing_backend/app/services/storage_service.py", "pattern": "/^    def save_new_version(self, user_id: int, document_id: int, filename: str, file_stream) -> Tu/", "language": "Python", "typeref": "typename:Tuple[str,int,str]", "kind": "member", "signature": "(self, user_id: int, document_id: int, filename: str, file_stream)", "scope": "StorageService", "scopeKind": "class"}], "hash": "675b287d971f7536c445148bb43eb024", "format-version": 4, "code-base-name": "intelligent_receipt_processing_backend", "filename": "intelligent_receipt_processing_backend/app/services/storage_service.py"}