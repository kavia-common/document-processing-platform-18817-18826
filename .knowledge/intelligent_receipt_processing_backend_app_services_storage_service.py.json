{"is_source_file": true, "format": "Python", "description": "This source file defines the StorageService class which manages file storage operations within a designated root directory, including saving new file versions and retrieving absolute paths for stored files.", "external_files": ["os", "shutil", "datetime", "typing.Tuple", "flask.current_app", "../utils"], "external_methods": ["ensure_dir", "compute_checksum"], "published": ["save_new_version", "get_absolute_path"], "classes": [{"name": "StorageService", "description": "Handles file storage management, organizing files per-user and per-document with versioning support."}], "methods": [{"name": "__init__(self)", "description": "Initializes the StorageService with the root storage directory.", "scope": "StorageService", "scopeKind": "class"}, {"name": "str _doc_dir(self, user_id: int, document_id: int)", "description": "Generates the directory path for storing documents of a specific user and document ID.", "scope": "StorageService", "scopeKind": "class"}, {"name": "Tuple[str,int,str] save_new_version(self, user_id: int, document_id: int, filename: str, file_stream)", "description": "Saves a new version of a file, returns relative path, size, and checksum.", "scope": "StorageService", "scopeKind": "class"}, {"name": "str get_absolute_path(self, relative_path: str)", "description": "Returns the absolute file system path for a given relative storage path.", "scope": "StorageService", "scopeKind": "class"}], "calls": ["ensure_dir(self.root)", "ensure_dir(path)", "os.path.join", "datetime.utcnow", "shutil.copyfileobj", "os.path.getsize", "compute_checksum", "os.path.relpath", "os.path.basename"], "search-terms": ["StorageService", "file storage", "save_new_version", "get_absolute_path", "per-user storage", "document versioning", "STORAGE_ROOT"], "state": 2, "file_id": 10, "knowledge_revision": 22, "git_revision": "", "ctags": [{"_type": "tag", "name": "StorageService", "path": "/home/kavia/workspace/code-generation/document-processing-platform-18817-18826/intelligent_receipt_processing_backend/app/services/storage_service.py", "pattern": "/^class StorageService:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "__init__", "path": "/home/kavia/workspace/code-generation/document-processing-platform-18817-18826/intelligent_receipt_processing_backend/app/services/storage_service.py", "pattern": "/^    def __init__(self):$/", "language": "Python", "kind": "member", "signature": "(self)", "scope": "StorageService", "scopeKind": "class"}, {"_type": "tag", "name": "_doc_dir", "path": "/home/kavia/workspace/code-generation/document-processing-platform-18817-18826/intelligent_receipt_processing_backend/app/services/storage_service.py", "pattern": "/^    def _doc_dir(self, user_id: int, document_id: int) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(self, user_id: int, document_id: int)", "scope": "StorageService", "scopeKind": "class"}, {"_type": "tag", "name": "get_absolute_path", "path": "/home/kavia/workspace/code-generation/document-processing-platform-18817-18826/intelligent_receipt_processing_backend/app/services/storage_service.py", "pattern": "/^    def get_absolute_path(self, relative_path: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(self, relative_path: str)", "scope": "StorageService", "scopeKind": "class"}, {"_type": "tag", "name": "save_new_version", "path": "/home/kavia/workspace/code-generation/document-processing-platform-18817-18826/intelligent_receipt_processing_backend/app/services/storage_service.py", "pattern": "/^    def save_new_version(self, user_id: int, document_id: int, filename: str, file_stream) -> Tu/", "language": "Python", "typeref": "typename:Tuple[str,int,str]", "kind": "member", "signature": "(self, user_id: int, document_id: int, filename: str, file_stream)", "scope": "StorageService", "scopeKind": "class"}], "hash": "36c3724e809d6632d885c4c0c66cc1de", "format-version": 4, "code-base-name": "intelligent_receipt_processing_backend", "filename": "intelligent_receipt_processing_backend/app/services/storage_service.py", "revision_history": [{"22": ""}]}